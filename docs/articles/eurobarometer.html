<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Case Study: Working With Eurobarometer • retroharmonize</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Case Study: Working With Eurobarometer">
<meta property="og:description" content="retroharmonize">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">retroharmonize</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/afrobarometer.html">Case Study: Working With Afrobarometer</a>
    </li>
    <li>
      <a href="../articles/eurobarometer.html">Case Study: Working With Eurobarometer</a>
    </li>
    <li>
      <a href="../articles/harmonize_labels.html">Harmonize Value Labels</a>
    </li>
    <li>
      <a href="../articles/labelled_spss_survey.html">The labelled_spss_survey class</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/antaldaniel/retroharmonize/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="eurobarometer_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Case Study: Working With Eurobarometer</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/antaldaniel/retroharmonize/blob/master/vignettes/eurobarometer.Rmd"><code>vignettes/eurobarometer.Rmd</code></a></small>
      <div class="hidden name"><code>eurobarometer.Rmd</code></div>

    </div>

    
    
<p>In the <a href="http://retroharmonize.satellitereport.com/articles/afrobarometer.html">Afrobaromter Case Study</a> we have shown how to merge two waves of a survey with a limited number of variables. This workflow is not feasible with Eurobarometer on a PC or laptop, because there are too many large files to handle.</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">retroharmonize</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">dplyr</span>)</pre></body></html></div>
<p>We have created a helper function <code>subset_save_survey()</code> that programmatically reads in SPSS files, makes the necessary type conversion to <code><a href="../reference/labelled_spss_survey.html">labelled_spss_survey()</a></code> without harmonization, and saves a small, subsetted <code>rds</code> file. Because this is a native R file, it is far more efficient to handle in the actual workflow.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="co"># To replicate the worklist, you need to have the SPSS file names </span>
<span class="co"># as a list, and you have to set up your own import and export path.</span>

<span class="fu"><a href="../reference/subset_save_surveys.html">subset_save_surveys</a></span> (
  <span class="kw">survey_list</span> <span class="kw">=</span> <span class="no">eb_metadata</span>,
  <span class="kw">selection_name</span> <span class="kw">=</span> <span class="st">"trust"</span>,
  <span class="kw">import_path</span> <span class="kw">=</span> <span class="no">gesis_dir</span>,
  <span class="kw">export_path</span> <span class="kw">=</span> <span class="st">"working"</span> )</pre></body></html></div>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="no">eurobarometer_waves</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="st">"working"</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.files.html">dir</a></span>(<span class="st">"working"</span>))
<span class="no">eb_waves</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/read_surveys.html">read_surveys</a></span>(<span class="no">eurobarometer_waves</span>, <span class="kw">.f</span><span class="kw">=</span><span class="st">'read_rds'</span>)</pre></body></html></div>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="kw">if</span> ( <span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.exists</a></span>(<span class="st">"working"</span>) ) {
  <span class="no">eurobarometer_waves</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="st">"working"</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.files.html">dir</a></span>(<span class="st">"working"</span>))
} <span class="kw">else</span> {
  <span class="no">eurobarometer_waves</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="st">".."</span>, <span class="st">"working"</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.files.html">dir</a></span>(<span class="st">"working"</span>))
}

<span class="no">eb_waves</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/read_surveys.html">read_surveys</a></span>(<span class="no">eurobarometer_waves</span>, <span class="kw">.f</span><span class="kw">=</span><span class="st">'read_rds'</span>)</pre></body></html></div>
<div id="metadata-map" class="section level2">
<h2 class="hasAnchor">
<a href="#metadata-map" class="anchor"></a>Metadata map</h2>
<p>Let’s analyze the metadata of each survey file.</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="no">eb_trust_metadata</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span> ( <span class="kw">X</span> <span class="kw">=</span> <span class="no">eb_waves</span>, <span class="kw">FUN</span> <span class="kw">=</span> <span class="no">metadata_create</span>   )
<span class="no">eb_trust_metadata</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span>(<span class="no">rbind</span>, <span class="no">eb_trust_metadata</span>)</pre></body></html></div>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">eb_trust_metadata</span>)
<span class="co">#&gt;           filename           id             var_name_orig</span>
<span class="co">#&gt; 1 ZA2828_trust.rds ZA2828_trust                     rowid</span>
<span class="co">#&gt; 2 ZA2828_trust.rds ZA2828_trust                country_id</span>
<span class="co">#&gt; 3 ZA2828_trust.rds ZA2828_trust          weight_poststrat</span>
<span class="co">#&gt; 4 ZA2828_trust.rds ZA2828_trust trust_european-commission</span>
<span class="co">#&gt; 5 ZA2828_trust.rds ZA2828_trust trust_national-government</span>
<span class="co">#&gt; 6 ZA2828_trust.rds ZA2828_trust trust_european-parliament</span>
<span class="co">#&gt;                            class_orig</span>
<span class="co">#&gt; 1                           character</span>
<span class="co">#&gt; 2                           character</span>
<span class="co">#&gt; 3                             numeric</span>
<span class="co">#&gt; 4 retroharmonize_labelled_spss_survey</span>
<span class="co">#&gt; 5 retroharmonize_labelled_spss_survey</span>
<span class="co">#&gt; 6 retroharmonize_labelled_spss_survey</span>
<span class="co">#&gt;                                             label_orig  labels valid_labels</span>
<span class="co">#&gt; 1                    unique identifier in za2828_trust      NA           NA</span>
<span class="co">#&gt; 2 nation all samples iso 3166 crosstabulation variable      NA           NA</span>
<span class="co">#&gt; 3                            weight result from target      NA           NA</span>
<span class="co">#&gt; 4                          rely on european commission 1, 2, 3         1, 2</span>
<span class="co">#&gt; 5                          rely on national government 1, 2, 3         1, 2</span>
<span class="co">#&gt; 6                          rely on european parliament 1, 2, 3         1, 2</span>
<span class="co">#&gt;   na_labels na_range n_labels n_valid_labels n_na_labels</span>
<span class="co">#&gt; 1        NA       NA        0              0           0</span>
<span class="co">#&gt; 2        NA       NA        0              0           0</span>
<span class="co">#&gt; 3        NA       NA        0              0           0</span>
<span class="co">#&gt; 4         3       NA        3              2           1</span>
<span class="co">#&gt; 5         3       NA        3              2           1</span>
<span class="co">#&gt; 6         3       NA        3              2           1</span></pre></body></html></div>
<p>The value labels in this example are not too numerous. The only variable that stands out is the <code>Can rely on</code> and <code>Cannot rely on</code> labelled variable.</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="no">valid_labels</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span> (
  <span class="no">eb_trust_metadata</span>$<span class="no">valid_labels</span>, <span class="no">unlist</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(<span class="no">.</span>, <span class="no">names</span> )
<span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span>(<span class="no">valid_labels</span>)))
<span class="co">#&gt; [1] "CAN RELY ON IT"    "CANNOT RELY ON IT" "Tend to trust"    </span>
<span class="co">#&gt; [4] "Tend not to trust" "DK"</span></pre></body></html></div>
</div>
<div id="harmonize-the-labels" class="section level2">
<h2 class="hasAnchor">
<a href="#harmonize-the-labels" class="anchor"></a>Harmonize the labels</h2>
<p>For easier looping we adopt the <code><a href="../reference/harmonize_values.html">harmonize_values()</a></code> function with new default settings. It would be tempting to preserve the <code>rely</code> labels, but if we use the same numeric coding, it will lead to confusion. If you want to keep the difference of the two type of category labels, than the harmonization should be done in a two-step process.</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="no">harmonize_eb_trust</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">x</span>) {
  <span class="no">label_list</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(
    <span class="kw">from</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"^tend\\snot"</span>, <span class="st">"^cannot"</span>,
             <span class="st">"^tend\\sto"</span>, <span class="st">"^can\\srely"</span>,
             <span class="st">"^dk"</span>, <span class="st">"^decline"</span>, <span class="st">"^inap"</span>),
    <span class="kw">to</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"not_trust"</span>, <span class="st">"not_trust"</span>, <span class="st">"trust"</span>, <span class="st">"trust"</span>,
           <span class="st">"do_not_know"</span>, <span class="st">"declined"</span>, <span class="st">"inap"</span>),
    <span class="kw">numeric_values</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">99997</span>,<span class="fl">99998</span>,<span class="fl">99999</span>)
  )

  <span class="fu"><a href="../reference/harmonize_values.html">harmonize_values</a></span>(<span class="no">x</span>,
                   <span class="kw">harmonize_labels</span> <span class="kw">=</span> <span class="no">label_list</span>,
                   <span class="kw">na_values</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"do_not_know"</span><span class="kw">=</span><span class="fl">99997</span>,
                                 <span class="st">"declined"</span><span class="kw">=</span><span class="fl">99998</span>,
                                 <span class="st">"inap"</span><span class="kw">=</span><span class="fl">99999</span>),
                   <span class="kw">na_range</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>( <span class="fl">99900</span>, <span class="fl">99999</span>)
  )
}</pre></body></html></div>
<p>We set a missing range, because we are not sure that all</p>
<p>Let’s see if it works:</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="fu">harmonize_eb_trust</span>(<span class="no">eb_waves</span><span class="kw">[[</span><span class="fl">4</span>]]$<span class="no">`trust_european-commission`</span>[<span class="fl">1</span>:<span class="fl">10</span>])
<span class="co">#&gt;  [1] 99997     1     0 99997     1     0     0     0     1 99997</span>
<span class="co">#&gt; attr(,"labels")</span>
<span class="co">#&gt;   not_trust       trust do_not_know </span>
<span class="co">#&gt;           0           1       99997 </span>
<span class="co">#&gt; attr(,"label")</span>
<span class="co">#&gt; [1] "QA27 EUROPEAN COMMISSION - TRUST"</span>
<span class="co">#&gt; attr(,"na_values")</span>
<span class="co">#&gt; [1] 99997</span>
<span class="co">#&gt; attr(,"class")</span>
<span class="co">#&gt; [1] "retroharmonize_labelled_spss_survey" "haven_labelled_spss"                </span>
<span class="co">#&gt; [3] "haven_labelled"                     </span>
<span class="co">#&gt; attr(,"survey_id_name")</span>
<span class="co">#&gt; [1] "x"</span>
<span class="co">#&gt; attr(,"survey_id_values")</span>
<span class="co">#&gt;     2     1     3 </span>
<span class="co">#&gt;     0     1 99997 </span>
<span class="co">#&gt; attr(,"survey_id_label")</span>
<span class="co">#&gt; [1] "QA27 EUROPEAN COMMISSION - TRUST"</span>
<span class="co">#&gt; attr(,"survey_id_labels")</span>
<span class="co">#&gt;     Tend to trust Tend not to trust                DK </span>
<span class="co">#&gt;                 1                 2                 3 </span>
<span class="co">#&gt; attr(,"survey_id_na_values")</span>
<span class="co">#&gt; [1] 3</span>
<span class="co">#&gt; attr(,"id")</span>
<span class="co">#&gt; [1] "survey_id"</span></pre></body></html></div>
<p>Appears to give the correct results, let’s run it through the 9 survey waves. Whenever a variable is missing from a wave, it is filled up with <code>inapproriate</code> missing values.</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="no">harmonized_eb_waves</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/harmonize_waves.html">harmonize_waves</a></span> ( <span class="kw">waves</span> <span class="kw">=</span> <span class="no">eb_waves</span>,
                                      <span class="kw">.f</span> <span class="kw">=</span> <span class="no">harmonize_eb_trust</span>)
<span class="co">#&gt; Warning: The `x` argument of `as_tibble.matrix()` must have unique column names if `.name_repair` is omitted as of tibble 2.0.0.</span>
<span class="co">#&gt; Using compatibility `.name_repair`.</span>
<span class="co">#&gt; This warning is displayed once every 8 hours.</span>
<span class="co">#&gt; Call `lifecycle::last_warnings()` to see where this warning was generated.</span></pre></body></html></div>
</div>
<div id="analyze-the-data" class="section level2">
<h2 class="hasAnchor">
<a href="#analyze-the-data" class="anchor"></a>Analyze the data</h2>
<p>If there is a <code>99901</code> value, it refers to an invalid observation. The missing value range is not correctly identified. It should be made sure that if there is an unrecognized category label it goes into the missing range (and is marked that it was not recognized.)</p>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="no">harmonized_eb_waves</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate_all.html">mutate_at</a></span> ( <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html">vars</a></span>(<span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">contains</a></span>(<span class="st">"trust"</span>)), <span class="no">as_factor</span> ) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>()
<span class="co">#&gt;     rowid            country_id        weight_poststrat</span>
<span class="co">#&gt;  Length:277374      Length:277374      Min.   :0.0095  </span>
<span class="co">#&gt;  Class :character   Class :character   1st Qu.:0.7471  </span>
<span class="co">#&gt;  Mode  :character   Mode  :character   Median :0.9451  </span>
<span class="co">#&gt;                                        Mean   :1.0000  </span>
<span class="co">#&gt;                                        3rd Qu.:1.1763  </span>
<span class="co">#&gt;                                        Max.   :6.9678  </span>
<span class="co">#&gt;                                                        </span>
<span class="co">#&gt;  trust_european-commission trust_national-government trust_european-parliament</span>
<span class="co">#&gt;  not_trust  : 87687        not_trust  :149351        not_trust  : 86910       </span>
<span class="co">#&gt;  trust      :109047        trust      :105644        trust      :117200       </span>
<span class="co">#&gt;  99901      : 27534        99901      :    23        99901      : 27537       </span>
<span class="co">#&gt;  do_not_know: 53106        do_not_know: 20856        do_not_know: 45727       </span>
<span class="co">#&gt;                            99999      :  1500                                 </span>
<span class="co">#&gt;                                                                               </span>
<span class="co">#&gt;                                                                               </span>
<span class="co">#&gt;  trust_national-parliament    trust_justice-system        trust_police   </span>
<span class="co">#&gt;  not_trust  :144288        0            : 55727    0            : 39423  </span>
<span class="co">#&gt;  trust      :107434        1            : 59928    1            : 78946  </span>
<span class="co">#&gt;  99901      :    19        invalid_label:152414    invalid_label:152417  </span>
<span class="co">#&gt;  do_not_know: 24133        99997        :  8305    99997        :  6088  </span>
<span class="co">#&gt;  99999      :  1500        99999        :  1000    99999        :   500  </span>
<span class="co">#&gt;                                                                          </span>
<span class="co">#&gt;                                                                          </span>
<span class="co">#&gt;          trust_army      trust_political-parties      trust_companies  </span>
<span class="co">#&gt;  0            : 27338   0            :132638     0            : 31669  </span>
<span class="co">#&gt;  1            : 84711   1            : 35656     1            : 21416  </span>
<span class="co">#&gt;  invalid_label:152421   invalid_label: 96966     invalid_label:215780  </span>
<span class="co">#&gt;  99997        : 11904   99997        : 11614     99997        :  8509  </span>
<span class="co">#&gt;  99999        :  1000   99999        :   500                           </span>
<span class="co">#&gt;                                                                        </span>
<span class="co">#&gt;                                                                        </span>
<span class="co">#&gt;     trust_european-union    trust_united-nations weight_extrapolated</span>
<span class="co">#&gt;  0            :90665     0            : 50559    Min.   :   140.8   </span>
<span class="co">#&gt;  1            :95971     1            : 81663    1st Qu.:  2674.3   </span>
<span class="co">#&gt;  invalid_label:65199     invalid_label:120656    Median :  6695.4   </span>
<span class="co">#&gt;  99997        :25039     99997        : 23996    Mean   : 15015.7   </span>
<span class="co">#&gt;  99999        :  500     99999        :   500    3rd Qu.: 18032.9   </span>
<span class="co">#&gt;                                                  Max.   :171193.5   </span>
<span class="co">#&gt;                                                  NA's   :126799</span></pre></body></html></div>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="no">numeric_harmonization</span> <span class="kw">&lt;-</span> <span class="no">harmonized_eb_waves</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate_all.html">mutate_at</a></span> ( <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html">vars</a></span>(<span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">contains</a></span>(<span class="st">"trust"</span>)), <span class="no">as_numeric</span> ) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate_all.html">mutate_at</a></span> ( <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html">vars</a></span>(<span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">contains</a></span>(<span class="st">"trust"</span>)), ~<span class="no">.</span>*<span class="no">weight_poststrat</span>)

<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">numeric_harmonization</span>)
<span class="co">#&gt;     rowid            country_id        weight_poststrat</span>
<span class="co">#&gt;  Length:277374      Length:277374      Min.   :0.0095  </span>
<span class="co">#&gt;  Class :character   Class :character   1st Qu.:0.7471  </span>
<span class="co">#&gt;  Mode  :character   Mode  :character   Median :0.9451  </span>
<span class="co">#&gt;                                        Mean   :1.0000  </span>
<span class="co">#&gt;                                        3rd Qu.:1.1763  </span>
<span class="co">#&gt;                                        Max.   :6.9678  </span>
<span class="co">#&gt;                                                        </span>
<span class="co">#&gt;  trust_european-commission trust_national-government trust_european-parliament</span>
<span class="co">#&gt;  Min.   :     0.00         Min.   :     0.00         Min.   :     0.00        </span>
<span class="co">#&gt;  1st Qu.:     0.00         1st Qu.:     0.00         1st Qu.:     0.00        </span>
<span class="co">#&gt;  Median :     0.74         Median :     0.00         Median :     0.76        </span>
<span class="co">#&gt;  Mean   : 12265.78         Mean   :   594.50         Mean   : 11877.61        </span>
<span class="co">#&gt;  3rd Qu.:     1.16         3rd Qu.:     0.86         3rd Qu.:     1.17        </span>
<span class="co">#&gt;  Max.   :303529.21         Max.   :300017.00         Max.   :303529.21        </span>
<span class="co">#&gt;  NA's   :53106             NA's   :20856             NA's   :45727            </span>
<span class="co">#&gt;  trust_national-parliament trust_justice-system  trust_police     </span>
<span class="co">#&gt;  Min.   :     0.00         Min.   :     0.0     Min.   :     0.0  </span>
<span class="co">#&gt;  1st Qu.:     0.00         1st Qu.:     0.0     1st Qu.:     0.0  </span>
<span class="co">#&gt;  Median :     0.00         Median :     0.6     Median :     0.8  </span>
<span class="co">#&gt;  Mean   :   599.67         Mean   :  7380.7     Mean   :  5151.0  </span>
<span class="co">#&gt;  3rd Qu.:     0.88         3rd Qu.:     1.0     3rd Qu.:     1.1  </span>
<span class="co">#&gt;  Max.   :300017.00         Max.   :383748.5     Max.   :321540.4  </span>
<span class="co">#&gt;  NA's   :24133             NA's   :152414       NA's   :152417    </span>
<span class="co">#&gt;    trust_army       trust_political-parties trust_companies   </span>
<span class="co">#&gt;  Min.   :     0.0   Min.   :     0.0        Min.   :     0.0  </span>
<span class="co">#&gt;  1st Qu.:     0.5   1st Qu.:     0.0        1st Qu.:     0.0  </span>
<span class="co">#&gt;  Median :     0.9   Median :     0.0        Median :     0.0  </span>
<span class="co">#&gt;  Mean   : 10198.6   Mean   :  6735.4        Mean   : 13632.8  </span>
<span class="co">#&gt;  3rd Qu.:     1.2   3rd Qu.:     0.5        3rd Qu.:     1.1  </span>
<span class="co">#&gt;  Max.   :558193.3   Max.   :696757.1        Max.   :476545.7  </span>
<span class="co">#&gt;  NA's   :152421     NA's   :96966           NA's   :215780    </span>
<span class="co">#&gt;  trust_european-union trust_united-nations weight_extrapolated</span>
<span class="co">#&gt;  Min.   :     0.0     Min.   :     0.0     Min.   :   140.8   </span>
<span class="co">#&gt;  1st Qu.:     0.0     1st Qu.:     0.0     1st Qu.:  2674.3   </span>
<span class="co">#&gt;  Median :     0.7     Median :     0.8     Median :  6695.4   </span>
<span class="co">#&gt;  Mean   : 11878.7     Mean   : 15439.7     Mean   : 15015.7   </span>
<span class="co">#&gt;  3rd Qu.:     1.1     3rd Qu.:     1.3     3rd Qu.: 18032.9   </span>
<span class="co">#&gt;  Max.   :476545.7     Max.   :416817.5     Max.   :171193.5   </span>
<span class="co">#&gt;  NA's   :65199        NA's   :120656       NA's   :126799</span></pre></body></html></div>
<p>We have a problem: the invalid values should go out to the missing range, but they are not always correctly labelled as missing. The names in the tibble should also be fixed.</p>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="no">numeric_harmonization</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(<span class="no">country_id</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise_all.html">summarize_if</a></span> ( <span class="no">is.numeric</span>, <span class="no">mean</span>, <span class="kw">na.rm</span><span class="kw">=</span><span class="fl">TRUE</span>)
<span class="co">#&gt; # A tibble: 38 x 14</span>
<span class="co">#&gt;    country_id weight_poststrat `trust_european~ `trust_national~</span>
<span class="co">#&gt;    &lt;chr&gt;                 &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;</span>
<span class="co">#&gt;  1 AL                     1.00            0.750            0.515</span>
<span class="co">#&gt;  2 AT                     1.00        11126.               0.544</span>
<span class="co">#&gt;  3 BE                     1.00        10227.              64.8  </span>
<span class="co">#&gt;  4 BG                     1.00        21616.               0.277</span>
<span class="co">#&gt;  5 CY                     1.00        19855.               0.458</span>
<span class="co">#&gt;  6 CY-TCC                 1.00            0.657        76647.   </span>
<span class="co">#&gt;  7 CZ                     1.00        19581.               0.245</span>
<span class="co">#&gt;  8 DE-E                   1.00         8305.             136.   </span>
<span class="co">#&gt;  9 DE-W                   1.00         9172.              52.1  </span>
<span class="co">#&gt; 10 DK                     1.00        10429.               0.537</span>
<span class="co">#&gt; # ... with 28 more rows, and 10 more variables:</span>
<span class="co">#&gt; #   `trust_european-parliament` &lt;dbl&gt;, `trust_national-parliament` &lt;dbl&gt;,</span>
<span class="co">#&gt; #   `trust_justice-system` &lt;dbl&gt;, trust_police &lt;dbl&gt;, trust_army &lt;dbl&gt;,</span>
<span class="co">#&gt; #   `trust_political-parties` &lt;dbl&gt;, trust_companies &lt;dbl&gt;,</span>
<span class="co">#&gt; #   `trust_european-union` &lt;dbl&gt;, `trust_united-nations` &lt;dbl&gt;,</span>
<span class="co">#&gt; #   weight_extrapolated &lt;dbl&gt;</span></pre></body></html></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Daniel Antal.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
