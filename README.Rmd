---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# retroharmonize

<!-- badges: start -->
[![Project Status: Minimal or no implementation has been done yet, or the repository is only intended to be a limited example, demo, or proof-of-concept.](https://www.repostatus.org/badges/latest/concept.svg)](https://www.repostatus.org/#concept)
[![license](https://img.shields.io/badge/license-GPL--3-blue.svg)](https://www.gnu.org/licenses/gpl-3.0.en.html)
[![CRAN_Status_Badge](https://www.r-pkg.org/badges/version/eurobarometer)](https://cran.r-project.org/package=eurobarometer)
[![DOI](https://zenodo.org/badge/DOI/10.5281/zenodo.3937746.svg)](https://doi.org/10.5281/zenodo.3937746)
[![Follow author](https://img.shields.io/twitter/follow/antaldaniel.svg?style=social)](https://twitter.com/intent/follow?screen_name=antaldaniel)
[![Codecov test coverage](https://codecov.io/gh/antaldaniel/retroharmonize/branch/master/graph/badge.svg)](https://codecov.io/gh/antaldaniel/retroharmonize?branch=master)
[![Travis build status](https://travis-ci.com/antaldaniel/retroharmonize.svg?branch=master)](https://travis-ci.com/antaldaniel/retroharmonize)
<!-- badges: end -->

The goal of `retroharmonize` is to allow the organization of data joins or panels from various data sources, particularly survey microdata files, by *retrospective harmonization* the value codes, the value labels, and the missing value ranges of the data in a reproducible manner with the help of comprehensive s3 classes.

Currently being generalized from problems solved in the  [github.com/antaldaniel/eurobarometer]((https://github.com/antaldaniel/eurobarometer)) package ([doi](https://doi.org/10.5281/zenodo.3825700).)


## Installation

Soon you can install the released version of retroharmonize from [CRAN](https://CRAN.R-project.org) with:

``` r
install.packages("retroharmonize")
```

And the development version from [GitHub](https://github.com/) with:

``` r
# install.packages("devtools")
devtools::install_github("antaldaniel/retroharmonize")
```
## Classes for retrospective harmonization

```{r}
library(retroharmonize)
eb <- read_rds ( 
  file = system.file(
    "examples", "ZA7576.rds", package = "retroharmonize"), 
  id = "Eurobarometer_91_5_subsample", 
  doi = "10.4232/1.13393"
  )
print(eb)
```

The `labelled_spss_survey` class is an extension of haven's `labelled_spss` class. It not only preserver variable and value labels and the user-defined missing range, but also gives an identifer, for example, the filename to the vector. See [Working With The labelled_spss_survey Class](http://retroharmonize.satellitereport.com/articles/labelled_spss_survey.html).

## Harmonize categorical variables and missing values

The aim of `retroharmonize` is to help the reproducible harmonization of survey data. This means that not only the numeric codes, the labels and the missing range is harmonized, but the original coding is preserved as metadata attributes for documentation and validation purposes. See more in the article [Harmonize Value Labels](http://retroharmonize.satellitereport.com/articles/harmonize_labels.html).

```{r binding}
library(retroharmonize)
library(haven)

h2 <- harmonize_values(
  eb$qa14_2,  
  harmonize_labels = list(
    from = c("^tend to", "^tend not", "dk", "^inap"), 
    to = c("trust", "not_trust", "do_not_know", "inap"), 
    numeric_values = c(1,0,99997,99999)
    ), 
  id = attr(eb, "id") )
str(h2)
```
```{r}
#the label ordering is not yet harmonized!!!
tibble::tibble (
  values  = labelled::val_labels(h2), 
  labels = names(labelled::val_labels(h2)),
  label_orig = names(attr(h2, "Eurobarometer_91_5_subsample_labels")),
  values_orig = names(attr(h2, "Eurobarometer_91_5_subsample_values"))
)
```

## Code of Conduct

Please note that the surveyharmonize project is released with a [Contributor Code of Conduct](https://contributor-covenant.org/version/2/0/CODE_OF_CONDUCT.html). By contributing to this project, you agree to abide by its terms.
